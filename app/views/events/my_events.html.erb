<div class="container mt-5">
  <h2>My Events</h2>
  <hr>

  <!-- Nav tabs -->
  <ul class="nav nav-tabs" id="eventTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="hosted-tab" data-bs-toggle="tab" data-bs-target="#hosted" type="button" role="tab" aria-controls="hosted" aria-selected="true">
        Events I'm Hosting <span class="badge bg-secondary"><%= @hosted_events.count %></span>
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="reserved-tab" data-bs-toggle="tab" data-bs-target="#reserved" type="button" role="tab" aria-controls="reserved" aria-selected="false">
        Events I've Reserved <span class="badge bg-secondary"><%= @reserved_events.count %></span>
      </button>
    </li>
  </ul>

  <br>

  <!-- Tab content -->
  <div class="tab-content" id="eventTabsContent">
    <!-- Hosted Events -->
    <div class="tab-pane fade show active" id="hosted" role="tabpanel" aria-labelledby="hosted-tab">
      <% if @hosted_events.any? %>
        <% @hosted_events.each do |event| %>
          <div class="card mb-3">
            <% if event.game.image_url.present? %>
              <div class="row g-0">
                <div class="col-md-4">
                  <%= image_tag event.game.image_url, class: "img-fluid rounded-start", style: "max-width: 300px; height: auto;", alt: "#{event.game.title}" %>
                </div>
                <div class="col-md-8">
                  <div class="card-body">
                    <h5 class="card-title"><%= event.title %></h5>
                    <p class="card-text"><small class="text-muted">Date: <%= event.date_time.strftime("%B %d, %Y at %I:%M %p") %></small></p>
                    <p class="card-text"><small class="text-muted">Location: <%= event.location %></small></p>
                    <div class="btn-group" role="group" aria-label="Event Actions">
                      <%= link_to event_path(event), class: "btn btn-primary" do %>
                        <i class="fas fa-eye"></i> View Event
                      <% end %>
                      <%= link_to edit_event_path(event), class: "btn btn-warning" do %>
                        <i class="fas fa-edit"></i> Edit Event
                      <% end %>
                      <%= link_to event, data: { turbo_method: :delete }, class: "btn btn-danger" do %>
                        <i class="fas fa-trash-alt"></i> Delete Event
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>
            <% else %>
              <div class="card-body">
                <h5 class="card-title"><%= event.title %></h5>
              </div>
            <% end %>
          </div>
        <% end %>
      <% else %>
        <p>You are not hosting any events.</p>
      <% end %>
    </div>

    <!-- Reserved Events -->
    <div class="tab-pane fade" id="reserved" role="tabpanel" aria-labelledby="reserved-tab">
      <% if @reserved_events.any? %>
        <% @reserved_events.each do |event| %>
          <% reservation = event.reservations.find_by(sender: current_user) %>
          <div class="card mb-3">
            <% if event.game.image_url.present? %>
              <div class="row g-0">
                <div class="col-md-4">
                  <%= image_tag event.game.image_url, class: "img-fluid rounded-start", style: "max-width: 300px; height: auto;", alt: "#{event.game.title}" %>
                </div>
                <div class="col-md-8">
                  <div class="card-body">
                    <h5 class="card-title"><%= event.title %></h5>
                    <p class="card-text"><small class="text-muted">Date: <%= event.date_time.strftime("%B %d, %Y at %I:%M %p") %></small></p>
                    <p class="card-text"><small class="text-muted">Location: <%= event.location %></small></p>
                    <p class="card-text"><strong>Status:</strong> <%= reservation.status.titleize %></p>
                    <div class="btn-group" role="group" aria-label="Event Actions">
                      <%= link_to event_path(event), class: "btn btn-primary" do %>
                          <i class="fas fa-eye"></i> View Event
                        <% end %>
                        <%= link_to edit_reservation_path(reservation), class: "btn btn-secondary" do %>
                          <i class="fas fa-edit"></i> Update Reservation
                        <% end %>
                    </div>
                  </div>
                </div>
              </div>
            <% else %>
              <div class="card-body">
                <h5 class="card-title"><%= event.title %></h5>
                <p class="card-text"><%= event.description %></p>
                <p class="card-text"><small class="text-muted">Date: <%= event.date_time.strftime("%B %d, %Y at %I:%M %p") %></small></p>
                <p class="card-text"><small class="text-muted">Location: <%= event.location %></small></p>
                <%= link_to 'View Event', event_path(event), class: "btn btn-primary" %>
              </div>
            <% end %>
          </div>
        <% end %>
      <% else %>
        <p>You have no reserved events.</p>
      <% end %>
    </div>
  </div>
</div>
